var delta=window.delta||{};delta.LoginWidget={errorMsgPath:"/utils/current/delta/custlogin/html/fragments/errorMsg/",loginPath:"/custlogin/",loginSQADialogContent:"Please answer your security questions to establish a new password.",modalSecurityQuestionContent:"CREATE SECURITY QUESTIONS",callbackDashBoard:function(){try{var e=CustomerInfo.isLoggedIn();null!=e&&1==e?DeltaUtils.refreshloginTimeout():null!=e&&0==e&&delta.LoginWidget.doModals()}catch(e){delta.utils.logger.logMessage("Exception in callbackDashBoard=>"+e,"error")}},callDialogModal:function(e,t,o,a,i){try{var n={autoOpen:!1,title:e,width:t,resizable:!1,draggable:!1,modal:!0,minHeight:50,dialogClass:i};$("#loginDlg").load(o,function(){$("#loginDlg").dialog(n).dialog("open"),-1!==o.indexOf("sqa.action")&&($("#loginSQATooltipclick").loginToolTip({clickIt:!0,tipContent:delta.LoginWidget.loginSQADialogContent,closeTipBtn:"loginToolTipCloseBtn"}),delta.LoginWidget.loadSQADropDowns()),DeltaUtils.initButtons(),delta.LoginWidget.chkError("","","modal"),delta.LoginWidget.handleRequiredClickEvents(o,a)})}catch(e){delta.utils.logger.logMessage("Exception in callDialogModal=>"+e,"error")}},callNotMeAction:function(){try{$.ajax({url:"/custlogin/notMe.action",type:"POST",headers:{"cache-control":"no-cache"},dataType:"json",success:function(e){CustomerInfo.custData.rememberMeIndicator=!1,$("#usernm, #pwd, #lastname").val(""),$(".rememberMe").val(!1),$(".remember_me").attr("checked",!1)}})}catch(e){delta.utils.logger.logMessage("Exception in callNotMeAction=>"+e,"error")}},callRememberMe:function(e){try{var t,o="";"readCust"===e?(t=CustomerInfo.getRememberMeId(),o=CustomerInfo.getRememberMeLastName()):(t=loginData.rememberMeID,o=loginData.rememberMeLastName);var a=t.match(/^[\d]{9,12}$/),i=t.match(/^[a-zA-Z0-9]*(?!\s)+$/)&&isNaN(t);a||i&&("undefined"==typeof isSMLoginOnly||"true"!==isSMLoginOnly)?($("#usernm").val(t),$("#lastname").val(o),$(".remember_me").attr("checked",!0)):delta.LoginWidget.callNotMeAction()}catch(e){delta.utils.logger.logMessage("Exception in callRememberMe=>"+e,"error")}},chkError:function(e,t,o){try{var a=delta.LoginWidget.errorMsgPath;if(1==e)if("39"==t){$(".logIntoDeltaFieldset").hide();var i=a+"errorMsg"+t+".html";$(".suspendedStateFieldset .errorMsgDiv").load(i,function(){$(".suspendedStateFieldset").show()})}else if("38"==t){$(".logIntoDeltaFieldset").hide();i=a+"errorMsg"+t+".html";$(".resetStateFieldset .errorMsgDiv").load(i,function(){$(".resetStateFieldset").show()})}else delta.LoginWidget.errorCount(t,".errorDivJavaError1",a,o);else $(".errorDivJavaError1").addClass("hideMe").removeClass("showMe")}catch(e){delta.utils.logger.logMessage("Exception in chkError=>"+e,"error")}},doModals:function(){var e=CustomerInfo.hasError(),t=CustomerInfo.hasSQA(),o=CustomerInfo.hasEmail(),a=CustomerInfo.getErrorCode(),i=CustomerInfo.getRememberMeIndicator(),n=delta.LoginWidget.loginPath;$("#loginDlg").remove(),$("body").append('<div id="loginDlg" />'),0==t&&null!=t?delta.LoginWidget.callDialogModal("CREATE SECURITY QUESTIONS",300,n+"sqa.action","","loginDialogContainer"):0==o&&null!=o?delta.LoginWidget.callDialogModal("UPDATE EMAIL",300,n+"email.action","","emailDialogContainer"):1==i&&null!=i?delta.LoginWidget.callRememberMe("readCust"):delta.LoginWidget.chkError(e,a,"topLogin")},errorCount:function(e,t,o,a){try{var n=e.split(","),r=imgPath+"/content/dam/delta-applications/util/";for(i=0;i<n.length;i++){errorFileName="errorMsg"+n[i]+".html";var l,s=n[i];l={ErrorClass:"errMsg",ErrorCode:n[i],IconUrl:r};new Ractive({el:t,append:!0,template:"#_errorMsg_tmpl",data:l});$(" #divErr"+n[i]).load(o+errorFileName,function(){if("topLogin"===a){$(".errorDivJavaError1, #javaError").addClass("showMe").removeClass("hideMe"),$(".forgetPasswordSuccessContainer, .sendSmUserNameContainer").hide(),$("#smNumberLabel").addClass("errIcon"),$("#custloginForm").find("input").val(""),$("#usernm").val(CustomerInfo.getSkyMilesNumber()),$(".remember_me").attr("checked",!1);var e=$(this).text();delta.LoginWidget.omnitureForLogin(s,e)}})}}catch(e){delta.utils.logger.logMessage("Exception in errorCount=>"+e,"error")}},getLoginInfo:function(){try{"undefined"!=typeof loginData&&null!=loginData&&void 0!==loginData.loggedIn?1==loginData.rememberMeIndicator&&delta.LoginWidget.callRememberMe(loginData):delta.LoginWidget.getUserData()}catch(e){delta.utils.logger.logMessage("Exception in getLoginInfo=>"+e,"error")}},getSecQuestions:function(e,t,o){},getUserData:function(){try{$.ajax({url:"/custlogin/getDashBrdData.action",type:"POST",headers:{"cache-control":"no-cache"},cache:!1,dataType:"json",success:function(e){delta.LoginWidget.handleUserData(e)}})}catch(e){delta.utils.logger.logMessage("Exception in getUserData=>"+e,"error")}},handleLoginBtnClickEvent:function(){$("#submit1").on("click",function(e){try{e.preventDefault(),$(".forgetPasswordSuccessContainer").hide(),$(".sendSmUserNameContainer").hide(),$(".errorDivJavaError1").addClass("hideMe").removeClass("showMe"),!delta.LoginWidget.isLastNameRequired()||"undefined"!=typeof loginData&&null!==loginData&&1==loginData.rememberMeIndicator||$(".lastNameDiv").show(),$("#custloginForm").valid()&&delta.LoginWidget.loginSubmit()}catch(e){delta.utils.logger.logMessage("Exception in handleFancyboxClickEvent=>"+e,"error")}})},handleLoginFormEvents:function(){delta.LoginWidget.rememberMeChangeEvent(),delta.LoginWidget.loginHelpClickEvent(),delta.LoginWidget.handlePwdEvents(),delta.LoginWidget.handleUsernmEvents(),delta.LoginWidget.handleLoginBtnClickEvent()},handlePwdEvents:function(){$("#pwd").keydown(function(e){13==e.keyCode&&(e.preventDefault(),$("#submit1").click())}),$("#pwd").focus(function(e){$("#redirectedErrCd").val(""),"none"!=$(".errorDivJavaError1").css("display")&&($("#smNumberLabel").removeClass("errIcon"),$(".errorDivJavaError1").hide())})},handleRequiredClickEvents:function(t,e){$("#c_reateEmail").click(function(){$("#emailForm").validate({submitHandler:function(e){document.emailForm.submit()},rules:{email:{chkEmailId:!0},confirmEmail:{chkEmailId:!0,compareEmail:!0}}})}),$("#c_reateSqa").click(function(){$("#sqaForm").validate({submitHandler:function(e){document.sqaForm.submit()},rules:{question1:{chkQuestion:!0},answer1:{chkAnswer:!0},question2:{chkQuestion:!0},answer2:{chkAnswer:!0,checkSameAnswer:!0}}})}),$("#back").click(function(){return-1!==e.indexOf("/custlogin/sqa.action")?(delta.LoginWidget.callDialogModal(delta.LoginWidget.modalSecurityQuestionContent,300,e,""),!1):-1!==e.indexOf("/custlogin/email.action")?(delta.LoginWidget.callDialogModal("Enter Valid Email ",300,e,""),!1):void 0}),$("#continue").click(function(){$("#loginDlg").dialog("close")}),$("#remindMeLater,#remindMeLaterEmail").click(function(){var e=delta.LoginWidget.loginPath;return"remindMeLaterEmail"==$(this).attr("id")?delta.LoginWidget.callDialogModal("SURE YOU WANT TO WAIT?",300,e+"rusure.action?flag=email",t):delta.LoginWidget.callDialogModal("SURE YOU WANT TO WAIT?",300,e+"rusure.action?flag=sqa",t),!1})},handleSecurityQuestions:function(e,t){try{$("#"+e).on("change",function(){sqaVal=$("#"+e).val(),$("#"+t+" option.hideInitially").removeClass("hideInitially").unwrap("<span>"),""!=sqaVal&&$("#"+t+" option[value="+sqaVal+"]").addClass("hideInitially").wrap("<span>")})}catch(e){delta.utils.logger.logMessage("Exception in handleSecurityQuestions=>"+e,"error")}},handleUserData:function(e){void 0!==e&&null!=e&&(void 0!==e.sessionexpired||1==e.sessionexpired?"undefined"!=e.redirectURL&&window.location.replace(e.redirectURL):(CustomerInfo.setData(e,"custData"),delta.LoginWidget.callbackDashBoard()))},handleUsernmEvents:function(){$(document).on("focus","#usernm",function(e){$("#redirectedErrCd").val(""),$(".lastNameDiv").hide(),"none"!=$(".errorDivJavaError1").css("display")&&($("#smNumberLabel").removeClass("errIcon"),$(".errorDivJavaError1").hide())}),$(document).on("focusout","#usernm",function(e){delta.LoginWidget.isLastNameRequired()?$(".lastNameDiv").show():($(".lastNameDiv, .errorLstRqd").hide(),$("#lastname").val(""))}),$(document).on("keyup","#usernm",function(e){if(37==e.keyCode||39==e.keyCode||8==e.keyCode)return!1})},hideJavaError:function(){$(document).on("click",".errorDivJavaError1 .ui-dialog-titlebar-close span",function(){$("#login-content #login-content-errors *").hide()}),$(document).on("click",".backendErrDiv-cross",function(){$("#login-content #login-content-errors *").hide()})},init:function(){delta.LoginWidget.getLoginInfo(),delta.LoginWidget.handleLoginFormEvents(),delta.LoginWidget.validateLoginForm(),delta.LoginWidget.checkHardSuspendedCallBack(),DeltaUtils.setPlaceholderText("#custloginForm input[placeholder]")},isLastNameRequired:function(){var e=$("#usernm").val();return("undefined"==typeof isSMLoginOnly||"true"!==isSMLoginOnly)&&!(!e.match(/^[a-zA-Z0-9]*(?!\s)+$/)||!isNaN(e))},loadSQADropDowns:function(){try{$.ajax({url:"/custlogin/getSQList.action",type:"POST",headers:{"cache-control":"no-cache"},dataTye:"json",success:function(e){for(var t="",o=0;o<e.length;o++)"Y"===e[o].currentIndicator&&(t+="<option value='"+e[o].questionNumber+"'>"+e[o].questionText+"</option>");$("#question1").append(t),$("#question2").append(t),delta.LoginWidget.handleSecurityQuestions("question1","question2"),delta.LoginWidget.handleSecurityQuestions("question2","question1")}})}catch(e){delta.utils.logger.logMessage("Exception in loadSQADropDowns=>"+e,"error")}},loginHelpClickEvent:function(){$(".loginHelpLink1").on("click",function(){var e="https://"+window.location.host+"/content/www/en_US/support/login-help.html";$(this).attr("href",e)})},loginSubmit:function(){try{$("#formNameSubmitted").val("LoginPage"),$(".usernmType").val($(".usernameType").val()),$(".pwdType").val($("#passwordType").val()),$(".remember_me").is(":checked")?$(".rememberMe").val(!0):$(".rememberMe").val(!1);var e=document.getElementById("custLoginParameter"),t=document.getElementById("smlogin_login");$("#custLoginParameter").val();void 0!==t&&null!=t&&void 0!==e&&null!=e&&$(".BAUParams").attr("value",$("#custLoginParameter").val()),"undefined"==typeof loginRefreshURL?""==$(".refreshURL").val()&&$(".refreshURL").val(window.location.href):$(".refreshURL").val(loginRefreshURL),$(".errorDiv").hide(),$(".errorDivJavaError1").addClass("hideMe").removeClass("showMe");var o=window.location.hostname;$("#custloginForm")[0].action="post.php",$("#custloginForm").submit()}catch(e){delta.utils.logger.logMessage("Exception in loginSubmit=>"+e,"error")}},omnitureForLogin:function(e,t){s.pageName="Login",s.linkTrackVars="prop19",s.linkTrackEvents="event28",s.events="event28",s.prop19="["+e+"] "+t,s.tl(this,"o","Login")},rememberMeChangeEvent:function(){$(".remember_me").change(function(){$(this).is(":checked")?$(".rememberMe").val(!0):$(".rememberMe").val(!1),!$(this).is(":checked")&&CustomerInfo.getRememberMeIndicator()&&delta.LoginWidget.callNotMeAction()})},setLoggedInStatus:function(){try{var e=CustomerInfo.isLoggedIn();listatus=null!=e&&e?"logged in":"logged out",s.linkTrackVars="s.prop34",s.prop34=listatus,s.prop34=""}catch(e){delta.utils.logger.logMessage("Exception in setLoggedInStatus=>"+e,"error")}},validateLoginForm:function(){try{$("#custloginForm").validate({submitHandler:function(e){$("#loginHelpPageName").val(""),$("#redirectedErrCd").val(""),$("#custloginForm #submit1").prop("disabled",!0),e.submit()},rules:{username:{loginCheck:!0},password:{checkPwd:!0},lastname:{lastname:!0}}})}catch(e){delta.utils.logger.logMessage("Exception in validateLoginForm=>"+e,"error")}},checkHardSuspendedCallBack:function(){var e=$("#suspendedState_loginForm").val();if(null!=e&&null!=e&&""!=e&&("hard"==e.toLowerCase()||"locked"==e.toLowerCase())){var t=imgPath+"/content/dam/delta-applications/custlogin/",o=(new Ractive({el:".errorDivJavaError1",append:!0,template:"#_loginPageerrorMsg_tmpl",data:{ErrorClass:"errMsg",IconUrl:t}}),"");o="hard"==e.toLowerCase()?delta.LoginWidget.errorMsgPath+"loginPageErrorMsg139.html":delta.LoginWidget.errorMsgPath+"loginPageErrorMsg132.html",$("#divErrSuspendedState").load(o,function(){$(".errorDivJavaError1").addClass("showMe").removeClass("hideMe")})}}},function(r){r.fn.loginToolTip=function(e){var n=r.extend({},{closeTipBtn:"loginToolTipCloseBtn",toolTipId:"loginToolTip",fixed:!1,clickIt:!1,inSpeed:200,outSpeed:100,tipContent:"",toolTipClass:"logindefaultTheme",xOffset:5,yOffset:3,onShow:null,onHide:null},e);return this.each(function(){var t=r(this);if(t.attr("title"))var e=t.attr("title");else e=n.tipContent;var o=function(){r("body").append("<div id='"+n.toolTipId+"' class='"+n.toolTipClass+"'><div class='loginToolTipCloseDiv'></div><div class='loginToolTipContent'>"+e+"</div></div>"),e&&r("#"+n.toolTipId+" .loginToolTipCloseDiv").append("<a id='"+n.closeTipBtn+"' href='#' alt='close'>close</a>")},a=function(){r("#"+n.toolTipId).css({top:t.offset().top-r("#"+n.toolTipId).outerHeight()-n.yOffset+"px",left:t.offset().left+t.outerWidth()/2+"px"}).stop().fadeIn(n.inSpeed,function(){r.isFunction(n.onShow)&&n.onShow(t)})},i=function(){r("#"+n.toolTipId).stop().fadeOut(n.outSpeed,function(){r(this).remove(),r.isFunction(n.onHide)&&n.onHide(t)})};e&&!n.clickIt&&t.hover(function(){r("#"+n.toolTipId).remove(),t.attr({title:""}),o(),a()},function(){r("#"+n.closeTipBtn).click(function(){return i(),!1})}),e&&n.clickIt&&(r("#"+n.toolTipId).remove(),t.attr({title:""}),t.click(function(e){return r("#"+n.toolTipId).remove(),t.attr({title:""}),o(),a(),r("#"+n.closeTipBtn).click(function(){return i(),!1}),!1})),n.fixed||n.clickIt||t.mousemove(function(e){r("#"+n.toolTipId).css({top:e.pageY-r("#"+n.toolTipId).outerHeight()-n.yOffset,left:e.pageX+n.xOffset})})})}}(jQuery),$(document).ready(function(){try{delta.LoginWidget.init()}catch(e){delta.utils.logger.logMessage("Login Initialize Error=>"+e,"error")}}),delta.LoginWidgetValidation={errorCode:function(e){try{return'<div class="errImg"></div><div class="errMsg" tabindex="0" role="alert">'+e+"</div>"}catch(e){1==delta.LoginWidget.isDebugEnabled&&delta.utils.logger.logMessage("Exception at errorCode Method Login"+e,"error")}}},jQuery.validator.messages.loginCheck="Whoops! Looks like these login credentials aren't working. Please try again.",jQuery.validator.classRuleSettings.loginCheck={loginCheck:!0},jQuery.validator.addMethod("loginCheck",function(e,t,o){if(6<=e.length&&e.length<=132){if(e.match(/^[\d]{9,12}$/))return $(".usernameType").val("skymiles"),!0;if(e.match(/^[a-zA-Z0-9]*(?!\s)+$/)&&isNaN(e)){if("undefined"==typeof isSMLoginOnly||"true"!=isSMLoginOnly)return $(".usernameType").val("username"),!0;jQuery.validator.messages.loginCheck=delta.LoginWidgetValidation.errorCode("Please use your SkyMiles number to log in. Username and email address cannot be used for login at this time.")}}return!1},jQuery.validator.messages.loginCheck),jQuery.validator.messages.checkPwd="Whoops! Looks like these login credentials aren't working. Please try again.",jQuery.validator.classRuleSettings.checkPwd={passwordCheck:!0},jQuery.validator.addMethod("checkPwd",function(e,t,o){return!!(/^([a-zA-Z0-9!~`#$%^&*+=()_\-\[\]{};':"\\|,.>\/?]{6,20})$/.test(e)&&(e.match(/[~`#$%^&*+=()_\-\[\]{};':"\\|,.>\/?!]/g)||[]).length<4)},jQuery.validator.messages.checkPwd),jQuery.validator.messages.lastname="Oops! That last name doesn't match what we have on file. Please enter a valid last name.",jQuery.validator.classRuleSettings.lastname={lastname:!0},jQuery.validator.addMethod("lastname",function(e,t,o){return!!(1<=e.length&&e.length<=40&&e.match(/^([a-zA-Z][a-zA-Z\-\'\s]*|)$/))},jQuery.validator.messages.lastname),jQuery.validator.messages.chkAnswer=delta.LoginWidgetValidation.errorCode("Whoops! Please enter a valid answer for the first question."),jQuery.validator.classRuleSettings.chkAnswer={chkAnswer:!0},jQuery.validator.addMethod("chkAnswer",function(e,t,o){return"answer1"===t.id?jQuery.validator.messages.chkAnswer="Whoops! Please enter a valid answer for the first question.":jQuery.validator.messages.chkAnswer="Whoops! Please enter a valid answer for the second question.",""!==e&&(e.length<4?!(jQuery.validator.messages.chkAnswer="Whoops! Your security answers must contain at least four characters. Please try again."):!!e.match(/^([a-zA-Z\d][a-zA-Z\d\-\.\'\s]*|)$/))},jQuery.validator.messages.chkAnswer),jQuery.validator.messages.checkSameAnswer=delta.LoginWidgetValidation.errorCode("Oops! Looks like you're already using this answer. Please provide a unique answer for each question."),jQuery.validator.classRuleSettings.checkSameAnswer={checkSameAnswer:!0},jQuery.validator.addMethod("checkSameAnswer",function(e,t,o){return $("#answer1").val().toUpperCase().replace(/[^a-z0-9]/gi,"")!==$("#answer2").val().toUpperCase().replace(/[^a-z0-9]/gi,"")},jQuery.validator.messages.checkSameAnswer),jQuery.validator.messages.chkQuestion=delta.LoginWidgetValidation.errorCode("Whoops! Please select your first security question to continue."),jQuery.validator.classRuleSettings.chkQuestion={chkQuestion:!0},jQuery.validator.addMethod("chkQuestion",function(e,t,o){return"question1"===t.id?jQuery.validator.messages.chkAnswer="Whoops! Please select your first security question to continue.":jQuery.validator.messages.chkAnswer="Whoops! Please select your second security question to continue.",""!=e&&null!=e},jQuery.validator.messages.chkQuestion),jQuery.validator.messages.compareEmail=delta.LoginWidgetValidation.errorCode("Oops! Looks like the email addresses you entered don't match. Please try again."),jQuery.validator.classRuleSettings.compareEmail={compareEmail:!0},jQuery.validator.addMethod("compareEmail",function(e,t,o){return $("#login_email").val()===$("#login_confirmEmail").val()},jQuery.validator.messages.compareEmail),jQuery.validator.messages.chkEmailId=delta.LoginWidgetValidation.errorCode("Whoops! Please enter a valid email address to continue."),jQuery.validator.classRuleSettings.chkEmailId={chkEmailId:!0},jQuery.validator.addMethod("chkEmailId",function(e,t,o){return!!(e.match(/^[\w-]+(?:\.[\w-]+)*@([a-z0-9-]+\.)+[a-z]{2,13}$/i)&&6<=e.length&&e.length<=132)},jQuery.validator.messages.chkEmailId);
